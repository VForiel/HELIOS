# 2025.11.25-03: Réorganisation du notebook de démonstration

## Résumé
Réorganisation complète du notebook `examples/demo.ipynb` pour suivre le chemin optique logique d'une simulation astronomique, avec ajout de la visualisation des masques de phase atmosphériques.

## Objectif
Améliorer la pédagogie du notebook en présentant les concepts dans l'ordre du flux optique :
1. Scène observée (objets célestes + SEDs)
2. Effets atmosphériques (masques de phase turbulents)
3. Pupille du télescope (géométrie d'ouverture)
4. Masques coronagraphiques (suppression de l'étoile)

## Modifications apportées

### Fichier modifié
- `examples/demo.ipynb`

### Nouvelle structure du notebook

#### 1. Scene Observation (Cellules 1-8)
- **Cellule 1**: Titre et introduction avec description du flux optique
- **Cellule 2**: Imports
- **Cellule 3**: Définition de la scène (étoile, planète, zodiacal, exozodiacal)
- **Cellule 4**: Visualisation de la géométrie de la scène
- **Cellule 5**: Section "Spectral Energy Distributions"
- **Cellule 6**: Plot des SEDs de tous les objets (star, planet, zodi, exozodi)

#### 2. Atmospheric Phase Screen (Cellules 9-12) **NOUVEAU**
- **Cellule 9**: Introduction aux masques de phase atmosphériques
- **Cellule 10**: Génération et visualisation d'un masque de phase avec graine reproductible
  - Paramètres : RMS = 0.5 rad, seed = 42
  - Affichage du masque de phase coloré (twilight colormap)
  - Vérification du RMS effectif
- **Cellule 11**: Section "Temporal Evolution"
- **Cellule 12**: Évolution temporelle avec 6 graines différentes (42, 100, 200, 300, 400, 500)
  - Grille 2×3 montrant l'évolution du masque
  - Simule le "frozen-flow" de la turbulence

#### 3. Telescope Pupil Configuration (Cellules 13-17)
- **Cellule 13**: Section pupilles avec introduction
- **Cellule 14**: Construction manuelle + preset JWST côte à côte
- **Cellule 15**: Section "Diffraction Pattern"
- **Cellule 16**: Visualisation pupille + PSF JWST

#### 4. Coronagraphic Phase Masks (Cellules 13-19)
- **Cellule 13**: Introduction aux coronagraphes
- **Cellule 14**: Visualisation des masques de phase (vortex + 4-quadrant)
- **Cellule 15**: Section "Coronagraphic Imaging"
- **Cellule 16**: Application des coronagraphes à la scène rendue
  - Comparaison 3 panneaux : scène originale, vortex, 4QPM
  - Calcul du taux de suppression

#### 5. Advanced: Atmosphere + AO (Cellules 20-21)
- **Cellule 17**: Introduction atmosphère + optique adaptative
- **Cellule 18**: Comparaison de PSFs avec différents niveaux de turbulence et correction AO

#### 6. Full End-to-End Simulation (Cellules 22-23)
- **Cellule 19**: Section simulation complète
- **Cellule 20**: Pipeline complet Scene → Collectors → Camera

## Améliorations principales

### 1. Ordre logique du flux optique
**Avant** : Les sections étaient mélangées (pupilles avant atmosphère, coronagraphes dispersés)  
**Après** : Flux séquentiel clair suivant le chemin physique de la lumière

### 2. Nouvelle section atmosphère (MAJEUR)
- Visualisation des masques de phase atmosphériques (turbulence de Kolmogorov)
- **Graine reproductible** : Paramètre `seed` pour reproduire les mêmes masques
- **Évolution temporelle** : 6 snapshots simulant le "frozen-flow"
- Colormap `twilight` pour visualiser les phases de -π à +π
- Vérification du RMS effectif

### 3. Code amélioré pour les SEDs
```python
# Avant
ax = star.plot_sed(color='gold', label='Star', )
ax = planet.plot_sed(ax=ax, color='blue', label='Planet')

# Après (inclut tous les objets)
ax = star.plot_sed(ax=ax, color='gold', label='Star')
ax = planet.plot_sed(ax=ax, color='blue', label='Planet')
ax = zodi.plot_sed(ax=ax, color='gray', label='Zodiacal', alpha=0.7)
ax = exozodi.plot_sed(ax=ax, color='orange', label='Exozodiacal', alpha=0.7)
ax.legend()
ax.grid(True, alpha=0.3)
```

### 4. Visualisations améliorées
- **Pupilles** : Affichage côte à côte (manuelle vs JWST preset)
- **Coronagraphes** : Comparaison 3 panneaux avec marqueurs centraux
- **Atmosphère** : Grille 2×3 pour l'évolution temporelle

### 5. Suppression des redondances
- Supprimé la cellule dupliquée de masques coronagraphiques (#VSC-d91f7a42)
- Supprimé la cellule redondante d'imagerie coronagraphique (#VSC-fb12d8f9)
- Consolidé les sections liées

## Détails techniques de l'atmosphère

### Génération des masques de phase
```python
# Création avec seed reproductible
atm = helios.Atmosphere(rms=0.5*u.rad, seed=42)

# Application à un wavefront
wf = helios.Wavefront(wavelength=550e-9*u.m, size=512)
wf.field = pupil_amplitude.astype(np.complex128)
wf_atm = atm.process(wf, None)

# Extraction de la phase
phase = np.angle(wf_atm.field)  # Valeurs entre -π et +π
```

### Paramètres utilisés
- **RMS** : 0.5 radians (turbulence modérée)
- **Seeds** : 42, 100, 200, 300, 400, 500 (6 snapshots temporels)
- **Taille** : 512×512 pixels
- **Colormap** : 'twilight' (représentation cyclique des phases)

### Vérification physique
Le notebook vérifie que le RMS mesuré du masque correspond au RMS demandé :
```python
print(f"Phase RMS: {np.std(phase[p_amp > 0.1]):.3f} rad")
```

## Impact pédagogique

### Avantages de la nouvelle structure
1. **Cohérence physique** : Suit le trajet de la lumière
2. **Progression naturelle** : Chaque section construit sur la précédente
3. **Visualisations claires** : Masques de phase, évolution temporelle
4. **Reproductibilité** : Seeds pour résultats identiques
5. **Complétude** : Tous les aspects du pipeline sont couverts

### Structure narrative
1. "Qu'observons-nous ?" → Scene + SEDs
2. "Comment l'atmosphère affecte-t-elle la lumière ?" → Phase screens
3. "Comment collectons-nous la lumière ?" → Pupilles
4. "Comment supprimons-nous l'étoile ?" → Coronagraphes
5. "Comment corrigeons-nous l'atmosphère ?" → AO (avancé)
6. "Simulation complète" → Pipeline end-to-end

## Tests et validation

✅ Notebook réorganisé avec succès  
✅ Structure logique vérifiée (23 cellules)  
✅ Nouvelle section atmosphère ajoutée (4 cellules)  
✅ Redondances supprimées (2 cellules)  
✅ Code mis à jour avec la syntaxe concise `helios.Class`

## Notes

Cette réorganisation améliore significativement la compréhension du workflow HELIOS :
- Les débutants peuvent suivre le flux logique
- Les utilisateurs avancés ont accès aux détails (atmosphère, AO)
- Le code reste exécutable de haut en bas sans dépendances circulaires
- Les graines permettent la reproductibilité des résultats

La visualisation des masques de phase atmosphériques est particulièrement importante car :
1. Elle montre l'effet physique de la turbulence
2. Elle explique pourquoi l'AO est nécessaire
3. Elle démontre la nature stochastique de l'atmosphère
4. Elle permet de comprendre le concept de "frozen-flow"
