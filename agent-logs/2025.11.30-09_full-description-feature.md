# Agent Log: Full Description Feature

**Date**: 2025-11-30  
**Topic**: Adding full parameter description functionality

## Summary

Extended the `description()` methods across all classes with a `full: bool` parameter that provides comprehensive parameter information for complete observation setup documentation and debugging. Each class now implements `_get_detailed_attributes()` to expose all configuration parameters in a structured format.

## Files Modified

### Core Architecture (`src/helios/core/context.py`)

**Element class:**
- Added `full: bool` parameter to `description(indent, full=False)` method
- Added `_get_detailed_attributes() -> dict` method for subclasses to override
- Full mode displays all attributes with bullet points (•)

**Layer class:**
- Added `full: bool` parameter to `description(indent, full=False)` method
- Added `_get_detailed_attributes() -> dict` method for subclasses to override
- Full mode displays layer attributes AND propagates to all elements
- Improved tree formatting with proper indentation for multi-line element descriptions

**Context class:**
- Added `full: bool` parameter to `description(full=False)` method
- Full mode displays context parameters (date, declination)
- Propagates `full` parameter to all layers and elements

### Scene Components (`src/helios/components/scene.py`)

**CelestialBody:**
- Added `_get_detailed_attributes()` showing position if non-zero

**Star:**
- Added `_get_detailed_attributes()` showing:
  - temperature
  - magnitude
  - mass

**Planet:**
- Added `_get_detailed_attributes()` showing:
  - mass
  - radius
  - temperature
  - albedo
  - magnitude (if present)

**Scene (Layer):**
- Added `_get_detailed_attributes()` showing:
  - distance
  - num_objects

### Telescope Components (`src/helios/components/collector.py`)

**Collector (Element):**
- Added `_get_detailed_attributes()` showing:
  - position (x, y) in meters
  - size
  - pupil_diameter

**TelescopeArray (Layer):**
- Added `_get_detailed_attributes()` showing:
  - num_collectors
  - configuration (Single telescope vs Interferometric)
  - max_baseline (for interferometric arrays)
  - latitude, longitude, altitude (if non-zero)

### Detector Components (`src/helios/components/detectors.py`)

**Camera (Element):**
- Added `_get_detailed_attributes()` showing:
  - pixels (width × height)
  - dark_current (e-/s)
  - read_noise (e-)
  - integration_time
  - quantum_efficiency (as percentage)
  - gain (e-/ADU)
  - thermal_temp

### Beam Splitter (`src/helios/components/beam_splitter.py`)

**BeamSplitter (Element):**
- Added `_get_detailed_attributes()` showing:
  - transmission (as percentage)
  - reflection (as percentage)

## New Features

### 1. Full Parameter Documentation

The `full=True` parameter provides comprehensive documentation of all simulation parameters:

```python
ctx = helios.Context(date="2025-06-15", declination=-40.5*u.deg)

# Basic description (compact)
print(ctx.description(full=False))
# Output:
# HELIOS Simulation Context
# Layer 1: Scene 'HD 189733'
# Layer 2: TelescopeArray 'VLT'
# Layer 3: Camera 'SPHERE'

# Full description (detailed)
print(ctx.description(full=True))
# Output:
# HELIOS Simulation Context
# Context Parameters:
#   • date: 2025-06-15
#   • declination: -40.5 deg
# Layer 1: Scene 'HD 189733'
#   • distance: 12.5 pc
#   • num_objects: 2
#   ├─ Star 'HD 189733 A'
#   │    • temperature: 5040.0 K
#   │    • magnitude: 7.67
#   │    • mass: 0.82 solMass
#   └─ Planet 'HD 189733 b'
#        • temperature: 1200.0 K
#        • albedo: 0.15
# ...
```

### 2. Hierarchical Parameter Display

Parameters are displayed hierarchically with proper tree formatting:
- Context parameters at top level
- Layer parameters indented
- Element parameters further indented
- Uses Unicode box-drawing characters (├─, └─, │) for visual structure

### 3. Smart Parameter Filtering

Only relevant parameters are shown:
- Position only if non-zero
- Geographic coordinates only if specified
- Configuration type detected automatically (single vs interferometric)

### 4. Human-Readable Formatting

All parameters formatted for readability:
- Quantities include units
- Percentages for ratios (QE, beam splitter)
- Appropriate precision (2 decimals for positions, 1 for noise)
- Matrix notation for pixel dimensions (width × height)

## Use Cases

### 1. Observation Setup Documentation

Generate complete documentation of observation configuration:

```python
# Full exoplanet observation setup
ctx = build_exoplanet_observation()
with open('observation_log.txt', 'w') as f:
    f.write(ctx.description(full=True))
```

### 2. Debugging Simulation Configuration

Verify all parameters are correctly set:

```python
# Check if parameters match expectations
desc = ctx.description(full=True)
assert "integration_time: 60.0 s" in desc
assert "quantum_efficiency: 85.00%" in desc
```

### 3. Comparing Configurations

Side-by-side comparison of different setups:

```python
setup_a_desc = setup_a.description(full=True)
setup_b_desc = setup_b.description(full=True)
# Compare outputs to identify differences
```

### 4. Generating Observation Logs

Automatic logging of complete observation parameters:

```python
logger.info("Starting observation")
logger.info(ctx.description(full=True))
# Captures all relevant parameters for reproducibility
```

## Architecture Pattern

### Extension Points

To add detailed descriptions to new components:

1. **For Element subclasses:**
```python
class MyElement(Element):
    def _get_detailed_attributes(self) -> dict:
        attrs = super()._get_detailed_attributes()  # Inherit parent attrs
        attrs['my_param'] = str(self.my_param)
        return attrs
```

2. **For Layer subclasses:**
```python
class MyLayer(Layer):
    def _get_detailed_attributes(self) -> dict:
        attrs = super()._get_detailed_attributes()  # Inherit parent attrs
        attrs['layer_param'] = str(self.layer_param)
        return attrs
        # Elements automatically included via Layer.description()
```

### Formatting Guidelines

- Use appropriate precision for floats (avoid excessive decimals)
- Include units for all physical quantities
- Use percentages for ratios (0-1 → 0.00%-100.00%)
- Format arrays/tuples clearly (e.g., "2048 × 2048" for pixels)
- Omit parameters with default/zero values unless significant

## Tests

### Test Suite (`tests/test_full_description.py`)

Created comprehensive test coverage:
- ✓ `test_context_basic_description()` - Validates basic (non-full) mode
- ✓ `test_context_full_description()` - Validates full parameter display
- ✓ `test_element_full_description()` - Tests individual element details
- ✓ `test_layer_full_description()` - Tests layer hierarchical display
- ✓ `test_telescope_array_full_description()` - Tests interferometric detection
- ✓ `test_beam_splitter_full_description()` - Tests optical component details
- ✓ `test_parallel_layers_full_description()` - Tests beam splitting scenarios

All tests pass successfully.

### Demo Script (`examples/demo_full_description.py`)

Created realistic demonstrations:
1. **Exoplanet Direct Imaging** - VLT/SPHERE observation of HD 189733 b
2. **VLTI Interferometry** - Binary star observation with 4 UTs
3. **Dual-Channel Coronagraphy** - Beam-split observation with two cameras
4. **Comparison Demo** - Side-by-side full=False vs full=True

## Backward Compatibility

All changes are **fully backward compatible**:
- `description()` still works without parameters (defaults to `full=False`)
- Existing code unchanged, outputs remain identical
- New `full=True` parameter is opt-in

## Performance

Minimal performance impact:
- `_get_detailed_attributes()` only called when `full=True`
- Dictionary construction is lightweight
- String formatting is negligible for typical observation setups

## Future Enhancements

Potential improvements:
1. **Export formats**: Add JSON/YAML export for machine-readable logs
2. **Filtering**: Allow selecting specific parameter categories
3. **Diff mode**: Highlight differences between two contexts
4. **Validation**: Check parameter ranges and warn about unusual values
5. **Units conversion**: Display parameters in user-preferred units

## Benefits

1. **Reproducibility**: Complete parameter documentation for science
2. **Debugging**: Quick verification of all configuration values
3. **Documentation**: Auto-generated observation setup descriptions
4. **Validation**: Easy visual inspection of parameter correctness
5. **Education**: Clear display of all simulation components and settings
